@use "sass:map";

$app-root-selector: ":root";

@mixin get-properties-from-theme($theme, $themes) {
  @each $key, $value in map.get($themes, $theme) {
    @if $key != "meta" {
      --#{$key}: #{$value};
    }
  }
}


@mixin themes($themes) {
  @each $theme-name, $theme-content in $themes {
    $mode: map.get($theme-content, "meta", "mode");

    @if $mode {
      @media (prefers-color-scheme: $mode) {
        #{$app-root-selector} {
          @include get-properties-from-theme($theme-name, $themes);
        }
      }
    }
  
    @at-root #{$app-root-selector}[data-theme=#{$theme-name}] {
      @include get-properties-from-theme($theme-name, $themes);
    }
  }
}

// Theme mixins for custom properties
@mixin light() {
  @media (prefers-color-scheme: light) {
    @at-root #{selector-nest("#{$app-root-selector}[data-theme=os]", &)} {
      @content;
    }
  }

  @at-root #{selector-nest("#{$app-root-selector}[data-theme=light]", &)} {
    @content;
  }
}

@mixin dark() {
  @media (prefers-color-scheme: dark) {
    @at-root #{selector-nest("#{$app-root-selector}[data-theme=os]", &)} {
      @content;
    }
  }

  @at-root #{selector-nest("#{$app-root-selector}[data-theme=dark]", &)} {
    @content;
  }
}
